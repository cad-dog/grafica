<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grafica</title>
    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
  </head>
  <body onload="graficar();">
    Grafica
    <div
      style="height: 500px; width: 500px; border: 1px solid"
      id="grafica"
    ></div>
    <h4>Agregar Vertice</h4>
    Etiqueta:
    <input type="text" id="etiqueta" />
    <button onclick="agregaVertice();">Agregar</button>
    <br />
    <br />
    <h4>Agregar Arista</h4>
    Etiqueta:
    <input type="text" id="arista" />
    De:
    <input type="text" id="de" />
    a:
    <input type="text" id="a" />
    <button onclick="agregaArista();">Agregar</button>
    <br />
    <br />
    <h4>Eliminar Vertice</h4>
    Etiqueta:
    <input type="text" id="eliminar" />
    <button onclick="eliminaVertice();">Eliminar</button>
    <br />
    <br />
    <h4>Eliminar Arista</h4>
    Etiqueta:
    <input type="text" id="eliminarArista" />
    De:
    <input type="text" id="deEliminar" />
    a:
    <input type="text" id="aEliminar" />
    <button onclick="eliminaArista();">Eliminar</button>
    <br />
    <br />
    <h4>Buscar vertice</h4>
    Etiqueta:
    <input type="text" id="buscarVertice" />
    <button onclick="buscaVertice();">Buscar</button>
    <br />
    <br />
    <h4>Buscar Arista</h4>
    Etiqueta:
    <input type="text" id="buscarArista" />
    <button onclick="buscaArista();">Buscar</button>
    <br />
    <br />
    <h4>Grado Vertice</h4>
    Etiqueta:
    <input type="text" id="gradoVertice" />
    <button onclick="gradoVertice();">Conseguir grado</button>
    <br />
    <br />
    Numero de vertices
    <button onclick="numVertices();">numero vertices</button>
    <br />
    <br />
    Numero de aristas
    <button onclick="numAristas();">numero aristas</button>
    <br />
    <br />
    Vaciar vertice
    Etiqueta:
    <input type="text" id="vaciarVertice" />
    <button onclick="vaciarVertice();">Vaciar vertice</button>
    <br />
    <br />
    Vaciar grafica
    <button onclick="vaciaGrafica();">Vaciar grafica</button>


  </body>
  <script type="text/javascript">
    class Grafica {
      constructor() {
        this.vertices = [];
        this.aristas = {};
        this.numAristas = 0;
      }

      agregarVertice(vertice) {
        this.vertices.push(vertice);
        this.aristas[vertice] = [];
      }

      agregarArista(v1, v2, peso, etiqueta) {
        this.aristas[v1].push({ etiqueta: etiqueta, vertice: v2, peso: peso });
        this.aristas[v2].push({ etiqueta: etiqueta, vertice: v1, peso: peso });
      }

      eliminarVertice(vertice) {
        this.vertices = this.vertices.filter((v) => v != vertice);
      }

      eliminarArista(arista){
        Object.keys(this.aristas).map((i) =>{
          this.aristas[i] = this.aristas[i].filter((j) => j.arista != arista)
        })
      }

      buscaVertice(vertice) {
        return console.log(this.vertices.includes(vertice));
      }

      buscaArista(arista) {
        let encontrado = false
        Object.keys(this.aristas).map((i) =>{
          if(this.aristas[i].filter((j) => j.etiqueta == arista).length > 0) {
            encontrado = true
          }
        })
        return console.log(encontrado)
      }

      gradoVertice(vertice){
        return console.log(this.aristas[vertice].length)
      }

      numeroVertices(){
        return console.log(this.vertices.length)
      }

      numeroAristas(){
        return console.log(this.numAristas)
      }

      vaciaVertice(vertice) {
        this.aristas[vertice].map((arista) => {
          this.aristas[arista.vertice] = this.aristas[arista.vertice].filter((i) => i.vertice != vertice)
        })
        this.aristas[vertice] = []
      }

      vaciaGrafica(){
        this.vertices = []
        this.aristas = {}
      }

      pintarVertices() {
        console.log(this.vertices);
      }

      pintarAristas() {
        console.log(this.aristas);
      }




    }

    let vertices,
      aristas,
      graficaVis,
      idVertice = 1,
      idArista = 1;

    const grafica = new Grafica();

    const graficar = () => {
      vertices = new vis.DataSet([]);
      aristas = new vis.DataSet([]);

      let contenedor = document.getElementById("grafica");

      let datos = {
        nodes: vertices,
        edges: aristas,
      };
      let opciones = {};
      graficaVis = new vis.Network(contenedor, datos, opciones);
    };

    const agregaVertice = () => {
      if (
        vertices.get({
          filter: (item) => {
            return item.label == document.getElementById("etiqueta").value;
          },
        })[0]
      ) {
        return;
      }

      let etiqueta = document.getElementById("etiqueta").value;
      vertices.add({
        id: idVertice,
        label: etiqueta,
      });

      idVertice += 1;

      grafica.agregarVertice(etiqueta);
      grafica.pintarVertices();
      grafica.pintarAristas();

    };

    const agregaArista = () => {
      if (
        aristas.get({
          filter: (item) => {
            return item.label == document.getElementById("arista").value;
          },
        })[0]
      ) {
        return;
      }

      let v1, v2;

      v1 = vertices.get({
        filter: (item) => {
          return item.label == document.getElementById("de").value;
        },
      })[0];

      v2 = vertices.get({
        filter: (item) => {
          return item.label == document.getElementById("a").value;
        },
      })[0];

      let width = 10;

      aristas.add([
        {
          id: idArista,
          from: v1.id,
          to: v2.id,
          label: document.getElementById("arista").value,
        },
      ]);

      idArista += 1;

      grafica.agregarArista(
        v1.label,
        v2.label,
        0,
        document.getElementById("arista").value
      );

      grafica.numAristas+=1;

      grafica.pintarAristas();
    };

    const eliminaVertice = () => {
      vertices.remove({
        id: vertices.get({
          filter: (item) => {
            return item.label == document.getElementById("eliminar").value;
          },
        })[0].id,
      });

      grafica.eliminarVertice(document.getElementById("eliminar").value);
      grafica.pintarVertices();
    };

    const eliminaArista = () => {
      let arista = aristas.get({
        filter: (item) => {
          return item.label == document.getElementById("eliminarArista").value;
        },
      })[0];

      aristas.remove({ id: arista.id });

      grafica.eliminarArista(arista.label)
      grafica.numAristas-=1;
      grafica.pintarAristas();
    };

    const buscaVertice = () => {
      grafica.buscaVertice(document.getElementById("buscarVertice").value);
    };

    const buscaArista = () => {
      grafica.buscaArista(document.getElementById("buscarArista").value);
    };

    const gradoVertice = () => {
      grafica.gradoVertice(document.getElementById("gradoVertice").value)
    }

    const numVertices = () => {
      grafica.numeroVertices()
    }

    const numAristas = () => {
      grafica.numeroAristas()
    }

    const vaciarVertice = () => {
      let vertice = document.getElementById("vaciarVertice").value
      let arista;
      grafica.aristas[vertice].map((arista) => {
        arista = aristas.get({
        filter: (item) => {
          return item.label == arista.etiqueta;
        },
      })[0];

      aristas.remove({ id: arista.id });

      })

      grafica.vaciaVertice(vertice)
      grafica.pintarAristas()
    }

    const vaciaGrafica = () =>{
      vertices = new vis.DataSet([]);
      aristas = new vis.DataSet([]);
      let contenedor = document.getElementById("grafica");

      let datos = {
        nodes: vertices,
        edges: aristas,
      };
      let opciones = {};
      graficaVis = new vis.Network(contenedor, datos, opciones);
      grafica.vaciaGrafica()
      grafica.pintarAristas()
      grafica.pintarVertices()
    }


  </script>
</html>
